<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Fastify Generator | Database Schema Builder</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Poppins:wght@400;500;600;700&family=Fira+Code:wght@400;500&display=swap" rel="stylesheet">
  <style>
    :root {
      /* Color palette */
      --primary: #5E60CE;
      --primary-light: #6930C3;
      --primary-dark: #5390D9;
      --accent: #48BFE3;
      --accent-light: #64DFDF;
      --danger: #F72585;
      --success: #06D6A0;
      --warning: #FFD166;
      --dark: #22223B;
      --dark-surface: #4A4E69;
      --dark-code: #1c1c2e;
      --gray-100: #f8f9fa;
      --gray-200: #e9ecef;
      --gray-300: #dee2e6;
      --gray-400: #ced4da;
      --gray-500: #adb5bd;
      --gray-600: #6c757d;
      --gray-700: #495057;
      --gray-800: #343a40;
      --gray-900: #212529;
      --white: #ffffff;
      
      /* Typography */
      --font-heading: 'Poppins', sans-serif;
      --font-body: 'Inter', sans-serif;
      --font-code: 'Fira Code', monospace;
      
      /* Spacing */
      --space-xs: 0.25rem;
      --space-sm: 0.5rem;
      --space-md: 1rem;
      --space-lg: 1.5rem;
      --space-xl: 2rem;
      --space-xxl: 3rem;
      
      /* Shadows */
      --shadow-sm: 0 1px 3px rgba(0,0,0,0.1);
      --shadow-md: 0 4px 6px rgba(0,0,0,0.05), 0 1px 3px rgba(0,0,0,0.1);
      --shadow-lg: 0 10px 15px rgba(0,0,0,0.05), 0 1px 3px rgba(0,0,0,0.1);
      
      /* Border radius */
      --radius-sm: 4px;
      --radius-md: 8px;
      --radius-lg: 12px;
      --radius-xl: 20px;
      --radius-full: 9999px;
      
      /* Transitions */
      --transition-fast: 150ms ease;
      --transition-normal: 250ms ease;
      --transition-slow: 350ms ease;
    }

    /* Reset and base styles */
    *, *::before, *::after {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    
    body, html {
      font-family: var(--font-body);
      background-color: var(--gray-100);
      color: var(--gray-900);
      height: 100%;
      line-height: 1.5;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    body {
      overflow-x: hidden;
    }

    h1, h2, h3, h4, h5, h6 {
      font-family: var(--font-heading);
      font-weight: 600;
      color: var(--gray-900);
      line-height: 1.2;
    }

    h1 {
      font-size: 2.625rem;
      margin-bottom: 1.5rem;
    }

    h2 {
      font-size: 1.75rem;
      margin-bottom: 1.25rem;
    }

    h3 {
      font-size: 1.375rem;
      margin-bottom: 1rem;
      color: var(--gray-800);
    }

    h4 {
      font-size: 1.125rem;
      margin-bottom: 0.5rem;
    }

    p {
      margin-bottom: 1rem;
    }

    /* App layout */
    .app {
      display: flex;
      flex-direction: column;
      min-height: 100vh;
    }

    .hero::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: url('https://images.unsplash.com/photo-1580894908361-967195033215?q=80&w=2070&auto=format&fit=crop') center center;
      background-size: cover;
      opacity: 0.1;
      z-index: 0;
    }

    .hero-content {
      position: relative;
      z-index: 1;
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 var(--space-xl);
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: var(--space-xxl);
      align-items: center;
    }

    .hero-text {
      max-width: 600px;
    }

    .hero h1 {
      color: white;
      font-size: 3.5rem;
      margin-bottom: var(--space-md);
      line-height: 1.1;
    }

    .hero p {
      font-size: 1.25rem;
      margin-bottom: var(--space-xl);
      opacity: 0.9;
    }

    .hero-cta {
      display: flex;
      gap: var(--space-md);
    }

    .hero-image {
      position: relative;
      display: flex;
      justify-content: center;
    }

    .hero-image img {
      max-width: 100%;
      height: auto;
      border-radius: var(--radius-lg);
      box-shadow: var(--shadow-lg);
      transform: perspective(1000px) rotateY(-10deg);
      transition: transform var(--transition-normal);
    }

    .hero-image:hover img {
      transform: perspective(1000px) rotateY(0deg);
    }

    /* Floating shapes */
    .hero-shapes {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      pointer-events: none;
      z-index: 0;
    }

    .shape {
      position: absolute;
      border-radius: var(--radius-full);
      opacity: 0.2;
      filter: blur(40px);
    }

    .shape-1 {
      width: 300px;
      height: 300px;
      background-color: var(--accent);
      top: -50px;
      right: -100px;
      animation: float 8s ease-in-out infinite alternate;
    }

    .shape-2 {
      width: 200px;
      height: 200px;
      background-color: var(--primary-light);
      bottom: -70px;
      left: 10%;
      animation: float 10s ease-in-out infinite alternate-reverse;
    }

    /* Container grid */
    .container {
      max-width: 100%;
      margin: 0;
      padding: var(--space-md);
      width: 100%;
      height: 100%;
    }

    /* Main section layout */
    .main-section {
      padding: 0;
      position: relative;
      height: 100vh;
      overflow: hidden;
    }

    .main-grid {
      display: flex;
      gap: var(--space-xl);
    }
    
    .tables-content {
      flex: 1;
      overflow-y: auto;
      height: calc(100vh - var(--space-md) * 2);
    }

    @media (max-width: 1024px) {
      .main-grid {
        grid-template-columns: 1fr;
      }
      .hero-content {
        grid-template-columns: 1fr;
      }
      .hero-image {
        order: -1;
      }
    }

    /* Tables container */
    .tables-container {
      display: flex;
      flex-direction: column;
      gap: var(--space-xl);
      padding-bottom: var(--space-xl);
    }

    /* Table form */
    .table-form {
      background-color: var(--white);
      border-radius: var(--radius-lg);
      box-shadow: var(--shadow-md);
      padding: var(--space-xl);
      border: 1px solid var(--gray-200);
      transition: transform var(--transition-normal), box-shadow var(--transition-normal);
    }

    .table-form:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow-lg);
    }

    .table-form-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: var(--space-lg);
      padding-bottom: var(--space-md);
      border-bottom: 1px solid var(--gray-200);
    }

    .table-form-title {
      display: flex;
      align-items: center;
      gap: var(--space-sm);
    }

    .table-form-title i {
      color: var(--primary);
      font-size: 1.25rem;
    }

    /* Form elements */
    .form-row {
      display: flex;
      margin-bottom: var(--space-lg);
      gap: var(--space-lg);
      align-items: flex-start;
    }

    .form-group {
      flex: 1;
      display: flex;
      flex-direction: column;
    }

    .form-group.flex-end {
      flex: 0 0 auto;
      margin-left: auto;
      align-self: flex-end;
    }

    label {
      display: block;
      margin-bottom: var(--space-xs);
      font-weight: 500;
      color: var(--gray-800);
    }

    input, select {
      width: 100%;
      padding: 0.75rem var(--space-md);
      border: 1px solid var(--gray-300);
      border-radius: var(--radius-md);
      font-size: 0.9375rem;
      color: var(--gray-900);
      transition: border var(--transition-fast), box-shadow var(--transition-fast);
      background-color: var(--white);
    }

    input:focus, select:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(94, 96, 206, 0.15);
    }

    input::placeholder {
      color: var(--gray-500);
    }

    /* Column container */
    .column-container {
      background-color: var(--gray-100);
      border-radius: var(--radius-md);
      padding: var(--space-lg);
      margin-bottom: var(--space-lg);
      border: 1px solid var(--gray-200);
      transition: all var(--transition-normal);
    }

    .column-container:hover {
      border-color: var(--gray-300);
    }

    .column-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: var(--space-md);
    }

    /* Properties container */
    .properties-container {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
      gap: var(--space-md);
      margin-top: var(--space-lg);
      padding-top: var(--space-md);
      border-top: 1px solid var(--gray-200);
    }

    .property-checkbox {
      display: flex;
      align-items: center;
      gap: var(--space-xs);
      padding: var(--space-sm);
      background-color: var(--white);
      border-radius: var(--radius-sm);
      border: 1px solid var(--gray-200);
      transition: var(--transition-fast);
    }

    .property-checkbox:hover {
      background-color: var(--gray-100);
    }

    .property-checkbox label {
      margin-bottom: 0;
      font-size: 0.875rem;
      cursor: pointer;
    }

    .property-checkbox input[type="checkbox"] {
      width: 18px;
      height: 18px;
      border-radius: var(--radius-sm);
      border: 2px solid var(--gray-400);
      appearance: none;
      -webkit-appearance: none;
      position: relative;
      cursor: pointer;
      transition: var(--transition-fast);
      flex-shrink: 0;
    }

    .property-checkbox input[type="checkbox"]:checked {
      background-color: var(--primary);
      border-color: var(--primary);
    }

    .property-checkbox input[type="checkbox"]:focus {
      box-shadow: 0 0 0 3px rgba(94, 96, 206, 0.25);
    }

    .property-checkbox input[type="checkbox"]:checked::after {
      content: "✓";
      position: absolute;
      color: white;
      font-size: 12px;
      top: 1px;
      left: 3.5px;
    }

    /* Foreign key group */
    .foreign-key-group {
      margin-top: var(--space-lg);
      padding: var(--space-lg);
      background-color: var(--white);
      border: 1px solid var(--gray-300);
      border-radius: var(--radius-md);
      animation: fadeIn 0.3s ease forwards;
    }

    .show-on-foreign {
      display: none;
      opacity: 0;
      height: 0;
      overflow: hidden;
      transition: opacity var(--transition-normal);
    }

    /* Help text */
    .help-text {
      font-size: 0.75rem;
      color: var(--gray-600);
      margin-top: var(--space-xs);
    }

    /* Buttons */
    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 0.625rem var(--space-md);
      border: none;
      border-radius: var(--radius-md);
      font-size: 0.9375rem;
      font-weight: 500;
      text-align: center;
      cursor: pointer;
      transition: all var(--transition-fast);
      gap: var(--space-xs);
    }

    .btn i {
      font-size: 1rem;
    }

    .btn:focus {
      outline: none;
      box-shadow: 0 0 0 3px rgba(94, 96, 206, 0.25);
    }

    .btn-primary {
      background-color: var(--primary);
      color: white;
    }

    .btn-primary:hover {
      background-color: var(--primary-dark);
      transform: translateY(-1px);
    }

    .btn-primary:active {
      transform: translateY(0);
    }

    .btn-secondary {
      background-color: var(--gray-200);
      color: var(--gray-800);
    }

    .btn-secondary:hover {
      background-color: var(--gray-300);
      transform: translateY(-1px);
    }

    .btn-danger {
      background-color: var(--danger);
      color: white;
    }

    .btn-danger:hover {
      opacity: 0.9;
      transform: translateY(-1px);
    }

    .btn-success {
      background-color: var(--success);
      color: white;
    }

    .btn-success:hover {
      opacity: 0.9;
      transform: translateY(-1px);
    }

    .btn-outline {
      background-color: transparent;
      border: 1px solid var(--primary);
      color: var(--primary);
    }

    .btn-outline:hover {
      background-color: var(--primary);
      color: white;
    }

    /* Add table button */
    .add-table-btn-wrapper {
      padding: var(--space-md);
      margin-bottom: var(--space-xl);
      display: flex;
      justify-content: flex-start;
    }

    .add-table-btn {
      padding: var(--space-md) var(--space-lg);
      font-size: 1rem;
      font-weight: 600;
      border-radius: var(--radius-full);
      box-shadow: var(--shadow-md);
    }

    /* Output section */
    .output-panel {
      position: sticky;
      top: 0;
      width: 400px;
      height: calc(100vh - var(--space-md) * 2);
      overflow-y: auto;
    }

    .output-container {
      background: linear-gradient(135deg, var(--dark) 0%, var(--dark-surface) 100%);
      color: white;
      border-radius: var(--radius-lg);
      padding: var(--space-xl);
      display: flex;
      flex-direction: column;
      height: calc(80vh - 40px);
      box-shadow: var(--shadow-lg);
      position: relative;
      overflow: hidden;
    }

    .output-container::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: url('https://images.unsplash.com/photo-1483356256511-b48749959172?q=80&w=1740&auto=format&fit=crop');
      background-size: cover;
      opacity: 0.05;
      pointer-events: none;
    }

    .output-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: var(--space-lg);
      padding-bottom: var(--space-md);
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      position: relative;
      z-index: 1;
    }

    .output-header h2 {
      color: white;
      margin-bottom: 0;
      display: flex;
      align-items: center;
      gap: var(--space-sm);
    }

    .template-info {
      display: flex;
      align-items: center;
      margin-bottom: var(--space-lg);
      position: relative;
      z-index: 1;
    }

    .template-count {
      display: flex;
      align-items: center;
      font-size: 0.875rem;
      padding: var(--space-xs) var(--space-md);
      background-color: rgba(255, 255, 255, 0.1);
      border-radius: var(--radius-full);
      margin-right: var(--space-md);
    }

    .template-count i {
      margin-right: var(--space-xs);
      color: var(--accent);
    }

    #jsonOutput {
      background-color: var(--dark-code);
      color: #e7f2f8;
      border-radius: var(--radius-md);
      padding: var(--space-lg);
      font-family: var(--font-code);
      font-size: 0.875rem;
      line-height: 1.6;
      white-space: pre-wrap;
      overflow-x: auto;
      flex: 1;
      overflow-y: auto;
      position: relative;
      z-index: 1;
      box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.2);
    }

    /* Code highlighting */
    .json-string { color: #A8FF60; }
    .json-number { color: #FF9D00; }
    .json-boolean { color: #FFD966; }
    .json-null { color: #FF628C; }
    .json-key { color: #5EB0FF; }

    /* Copy button */
    .copy-btn {
      background-color: var(--accent);
      color: var(--gray-900);
      font-weight: 500;
      padding: 0.625rem var(--space-md);
      border-radius: var(--radius-md);
      transition: all var(--transition-fast);
    }

    .copy-btn:hover {
      background-color: var(--accent-light);
    }

    /* Empty state */
    .empty-state {
      text-align: center;
      padding: var(--space-xxl) var(--space-xl);
      background-color: var(--white);
      border-radius: var(--radius-lg);
      border: 2px dashed var(--gray-300);
    }

    .empty-state-icon {
      font-size: 3rem;
      color: var(--gray-400);
      margin-bottom: var(--space-lg);
    }

    .empty-state-title {
      font-size: 1.25rem;
      margin-bottom: var(--space-md);
      color: var(--gray-800);
    }

    .empty-state-text {
      color: var(--gray-600);
      margin-bottom: var(--space-lg);
    }

    /* Animations */
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    @keyframes slideUp {
      from { 
        opacity: 0; 
        transform: translateY(20px);
      }
      to { 
        opacity: 1; 
        transform: translateY(0);
      }
    }

    @keyframes float {
      0% { transform: translateY(0) rotate(0); }
      50% { transform: translateY(-15px) rotate(5deg); }
      100% { transform: translateY(0) rotate(0); }
    }

    .animate-in {
      animation: slideUp 0.5s ease forwards;
    }

    /* Loading animation */
    .loading-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: var(--white);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 9999;
    }

    .loading-animation {
      width: 80px;
      height: 80px;
      position: relative;
    }

    .loading-cube1, .loading-cube2 {
      background-color: var(--primary);
      width: 35px;
      height: 35px;
      position: absolute;
      top: 0;
      left: 0;
      animation: loading-animation 1.8s infinite ease-in-out;
      border-radius: var(--radius-sm);
    }

    .loading-cube2 {
      animation-delay: -0.9s;
    }

    @keyframes loading-animation {
      25% { transform: translateX(42px) rotate(-90deg) scale(0.5); }
      50% { transform: translateX(42px) translateY(42px) rotate(-180deg); }
      75% { transform: translateX(0px) translateY(42px) rotate(-270deg) scale(0.5); }
      100% { transform: rotate(-360deg); }
    }

    /* Responsive adjustments */
    @media (max-width: 768px) {
      .form-row {
        flex-direction: column;
        gap: var(--space-md);
      }
      
      .property-checkbox label {
        font-size: 0.75rem;
      }
      
      .properties-container {
        grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
      }
      
      .hero h1 {
        font-size: 2.5rem;
      }
      
      .hero p {
        font-size: 1rem;
      }
      
      .hero-cta {
        flex-direction: column;
        gap: var(--space-sm);
      }
    }
  </style>
</head>
<body>
  <!-- Loading Animation -->
  <div class="loading-overlay">
    <div class="loading-animation">
      <div class="loading-cube1"></div>
      <div class="loading-cube2"></div>
    </div>
  </div>

  <div class="app">

    <!-- Main Content -->
    <section class="main-section">
      <div class="container">
        <div class="main-grid">
          <div class="tables-content">
            <div id="tablesContainer" class="tables-container">
              <!-- Tables will be added here -->
            </div>

            <div class="add-table-btn-wrapper">
              <button id="addTableBtn" class="btn btn-primary add-table-btn">
                <i class="fas fa-plus-circle"></i> Add New Table
              </button>
            </div>
          </div>

          <div class="output-panel">
            <div class="output-container">
              <div class="output-header">
                <h2><i class="fas fa-code"></i> JSON Output</h2>
                <button id="downloadBtn" class="btn btn-secondary">
                  <i class="fas fa-download"></i> Download project
                </button>
              </div>
              
              <div class="template-info">
                <div class="template-count">
                  <i class="fas fa-table"></i> <span id="tableCount">0</span>  Tables
                </div>
              </div>
              
              <pre id="jsonOutput">// Your schema will appear here...</pre>
            </div>
          </div>
        </div>
      </div>
    </section>
  </div>

  <!-- Table Template (hidden) -->
  <template id="tableTemplate">
    <div class="table-form animate-in" data-table-id="">
      <div class="table-form-header">
        <div class="table-form-title">
          <i class="fas fa-table"></i>
          <h3>Table Configuration</h3>
        </div>
        <button class="btn btn-danger removeTableBtn">
          <i class="fas fa-trash-alt"></i> Remove
        </button>
      </div>
      
      <div class="form-row">
        <div class="form-group">
          <label for="tableName">Table Name</label>
          <input type="text" class="tableName" placeholder="Enter table name (e.g., users, products)" required>
        </div>
      </div>

      <h4><i class="fas fa-columns"></i> Columns</h4>
      <div class="columns-list">
        <!-- Columns will be added here -->
      </div>

      <div class="form-row">
        <div class="form-group">
          <button class="btn btn-secondary addColumnBtn">
            <i class="fas fa-plus"></i> Add Column
          </button>
        </div>
      </div>
    </div>
  </template>

  <!-- Column Template (hidden) -->
  <template id="columnTemplate">
    <div class="column-container animate-in" data-column-id="">
      <div class="column-header">
        <h4><i class="fas fa-grip-vertical"></i> Column Details</h4>
        <button class="btn btn-danger removeColumnBtn">
          <i class="fas fa-times"></i>
        </button>
      </div>
      
      <div class="form-row">
        <div class="form-group">
          <label>Column Name</label>
          <input type="text" class="columnName" placeholder="Enter column name" required>
        </div>
        <div class="form-group">
          <label>Data Type</label>
          <select class="columnType">
            <option value="integer">Integer</option>
            <option value="string">String</option>
            <option value="text">Text</option>
            <option value="date">Date</option>
            <option value="boolean">Boolean</option>
            <option value="decimal">Decimal</option>
            <option value="json">JSON</option>
            <option value="time">Time</option>
            <option value="timestamp">Timestamp</option>
          </select>
        </div>
      </div>

      <div class="properties-container">
        <div class="property-checkbox">
          <input type="checkbox" id="primary-${Date.now()}" class="prop-primary">
          <label for="primary-${Date.now()}">Primary Key</label>
        </div>
        <div class="property-checkbox">
          <input type="checkbox" id="increments-${Date.now()}" class="prop-increments">
          <label for="increments-${Date.now()}">Auto Increment</label>
        </div>
        <div class="property-checkbox">
          <input type="checkbox" id="notNullable-${Date.now()}" class="prop-notNullable">
          <label for="notNullable-${Date.now()}">Not Nullable</label>
        </div>
        <div class="property-checkbox">
          <input type="checkbox" id="show-${Date.now()}" class="prop-show">
          <label for="show-${Date.now()}">Display in UI</label>
        </div>
        <div class="property-checkbox">
          <input type="checkbox" id="foreign-${Date.now()}" class="prop-foreign foreignToggle">
          <label for="foreign-${Date.now()}">Foreign Key</label>
        </div>
      </div>

      <div class="foreign-key-group show-on-foreign">
        <div class="form-row">
          <div class="form-group">
            <label>Referenced Columns (comma separated)</label>
            <input type="text" class="foreignRef" placeholder="e.g., email.name">
            <div class="help-text">Format: columnName or columnName.displayColumn</div>
          </div>
        </div>
      </div>
    </div>
  </template>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      // Remove loading animation
      setTimeout(() => {
        document.querySelector('.loading-overlay').style.opacity = '0';
        setTimeout(() => {
          document.querySelector('.loading-overlay').style.display = 'none';
        }, 300);
      }, 1500);

      // Main section is visible by default now

      // Armazena todos os dados das tabelas
      let tables = [];
      let tableIdCounter = 0;
      let columnIdCounter = 0;

      // Elementos do DOM
      const tablesContainer = document.getElementById('tablesContainer');
      const addTableBtn = document.getElementById('addTableBtn');
      const jsonOutput = document.getElementById('jsonOutput');
      const downloadBtn = document.getElementById('downloadBtn');
      const tableCountEl = document.getElementById('tableCount');
      
      // Modelos
      const tableTemplate = document.getElementById('tableTemplate');
      const columnTemplate = document.getElementById('columnTemplate');

      // Syntax highlighting for JSON
      function syntaxHighlight(json) {
        if (!json) return '';
        // Convert the JSON to a string with proper formatting
        json = JSON.stringify(json, null, 2);
        // Replace specific patterns with styled spans
        return json.replace(/("(\\u[a-zA-Z0-9]{4}|\\[^u]|[^\\"])*"(\s*:)?|\b(true|false|null)\b|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?)/g, function (match) {
          let cls = 'json-number';
          if (/^"/.test(match)) {
            if (/:$/.test(match)) {
              cls = 'json-key';
            } else {
              cls = 'json-string';
            }
          } else if (/true|false/.test(match)) {
            cls = 'json-boolean';
          } else if (/null/.test(match)) {
            cls = 'json-null';
          }
          return '<span class="' + cls + '">' + match + '</span>';
        });
      }

      // Evento de adicionar tabela
      addTableBtn.addEventListener('click', addTable);

      // Inicializa com mensagem de estado vazio
      updateEmptyState();

      // Adiciona uma nova tabela
      function addTable() {
        tableIdCounter++;
        const tableId = `table-${tableIdCounter}`;
        
        // Clona o modelo de tabela
        const tableNode = document.importNode(tableTemplate.content, true);
        const tableElement = tableNode.querySelector('.table-form');
        tableElement.dataset.tableId = tableId;
        
        // Adiciona os ouvintes de eventos à nova tabela
        const removeTableBtn = tableNode.querySelector('.removeTableBtn');
        removeTableBtn.addEventListener('click', () => removeTable(tableId));
        
        const addColumnBtn = tableNode.querySelector('.addColumnBtn');
        addColumnBtn.addEventListener('click', () => addColumn(tableId));
        
        const tableNameInput = tableNode.querySelector('.tableName');
        tableNameInput.addEventListener('input', updateOutput);
        
        // Adiciona a tabela ao DOM
        tablesContainer.appendChild(tableNode);

        downloadBtn.addEventListener('click', () => { 
        // Extrair o texto sem tags HTML
        const tempEl = document.createElement('div');
        tempEl.innerHTML = jsonOutput.innerHTML;
        const textToCopy = tempEl.textContent;
        const parsedTables = JSON.parse(textToCopy);
        let templates = parsedTables.templates
        const arquivo = gerarProjetoCompleto(templates);

        // Trigger download of the arquivo
        const blob = new Blob([arquivo], { type: "text/plain;charset=utf-8" });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'arquivo.js';
        a.style.display = 'none';
        document.body.appendChild(a);
        a.click();
        setTimeout(() => {
          document.body.removeChild(a);
          window.URL.revokeObjectURL(url);
        }, 0);
        });

        
        // Adiciona a coluna 'id' padrão
        addColumn(tableId, 'id', ['primary', 'increments']);
        
        // Atualiza o array de tabelas
        tables.push({
          id: tableId,
          columns: []
        });
        
        updateEmptyState();
        updateOutput();
      }

      // Remove uma tabela
      function removeTable(tableId) {
        const tableElement = document.querySelector(`.table-form[data-table-id="${tableId}"]`);
        if (tableElement) {
          tableElement.classList.add('animate-out');
          
          setTimeout(() => {
            tableElement.remove();
            
            // Remove do array de tabelas
            tables = tables.filter(table => table.id !== tableId);
            
            updateEmptyState();
            updateOutput();
          }, 300);
        }
      }

      // Adiciona uma nova coluna a uma tabela
      function addColumn(tableId, defaultName = '', defaultProps = []) {
        columnIdCounter++;
        const columnId = `column-${columnIdCounter}`;
        const timestamp = Date.now();
        
        // Encontra o elemento da tabela
        const tableElement = document.querySelector(`.table-form[data-table-id="${tableId}"]`);
        if (!tableElement) return;
        
        const columnsList = tableElement.querySelector('.columns-list');
        
        // Clona o modelo de coluna
        const columnNode = document.importNode(columnTemplate.content, true);
        const columnContainer = columnNode.querySelector('.column-container');
        columnContainer.dataset.columnId = columnId;
        
        // Replace template IDs with unique IDs
        columnNode.querySelectorAll('[id*="${Date.now()}"]').forEach(el => {
          el.id = el.id.replace('${Date.now()}', timestamp);
        });
        columnNode.querySelectorAll('[for*="${Date.now()}"]').forEach(el => {
          el.setAttribute('for', el.getAttribute('for').replace('${Date.now()}', timestamp));
        });
        
        // Define valores padrão se fornecidos
        if (defaultName) {
          columnNode.querySelector('.columnName').value = defaultName;
        }
        
        // Adiciona os ouvintes de eventos
        const removeColumnBtn = columnNode.querySelector('.removeColumnBtn');
        removeColumnBtn.addEventListener('click', () => removeColumn(tableId, columnId));
        
        const columnInputs = columnNode.querySelectorAll('input, select');
        columnInputs.forEach(input => {
          input.addEventListener('change', updateOutput);
          input.addEventListener('input', updateOutput);
        });
        
        // Funcionalidade de alternância de chave estrangeira
        const foreignToggle = columnNode.querySelector('.foreignToggle');
        const foreignKeyGroup = columnNode.querySelector('.foreign-key-group');
        const primaryToggle = columnNode.querySelector('.prop-primary');
        const columnTypeSelect = columnNode.querySelector('.columnType');
        
        foreignToggle.addEventListener('change', function() {
          if (this.checked) {
            // Desmarcar primary key se foreign key for marcada
            if (primaryToggle.checked) {
              primaryToggle.checked = false;
            }
            foreignKeyGroup.classList.remove('show-on-foreign');
            columnTypeSelect.value = 'integer'; // Autoseleciona integer quando foreign key é marcada
          } else {
            foreignKeyGroup.classList.add('show-on-foreign');
          }
          updateOutput();
        });
        
        // Autoseleciona integer quando primary key é marcada
        primaryToggle.addEventListener('change', function() {
          if (this.checked) {
            // Desmarcar foreign key se primary key for marcada
            if (foreignToggle.checked) {
              foreignToggle.checked = false;
              foreignKeyGroup.classList.add('show-on-foreign');
            }
            columnTypeSelect.value = 'integer';
          }
          updateOutput();
        });
        
        // Define propriedades padrão se fornecidas
        if (defaultProps.length > 0) {
          defaultProps.forEach(prop => {
            const checkbox = columnNode.querySelector(`.prop-${prop}`);
            if (checkbox) checkbox.checked = true;
          });
          
          // Se tiver chave estrangeira, mostra o grupo
          if (defaultProps.includes('foreign')) {
            foreignKeyGroup.classList.remove('show-on-foreign');
          }
        }
        
        // Adiciona a coluna ao DOM
        columnsList.appendChild(columnNode);
        
        // Atualiza o array de tabelas
        const tableData = tables.find(table => table.id === tableId);
        if (tableData) {
          tableData.columns.push({
            id: columnId,
            name: defaultName,
            properties: defaultProps
          });
        }
        
        updateOutput();
      }

      // Remove uma coluna
      function removeColumn(tableId, columnId) {
        const columnElement = document.querySelector(`.column-container[data-column-id="${columnId}"]`);
        if (columnElement) {
          columnElement.style.opacity = '0';
          columnElement.style.transform = 'translateY(10px)';
          
          setTimeout(() => {
            columnElement.remove();
            
            // Remove do array de tabelas
            const tableData = tables.find(table => table.id === tableId);
            if (tableData) {
              tableData.columns = tableData.columns.filter(column => column.id !== columnId);
            }
            
            updateOutput();
          }, 300);
        }
      }

      // Atualiza a saída JSON
      function updateOutput() {
        const output = [];
        
        document.querySelectorAll('.table-form').forEach(tableForm => {
          const tableId = tableForm.dataset.tableId;
          const tableName = tableForm.querySelector('.tableName').value;
          
          if (!tableName) return;
          
          const tableObj = {
            "Tabela": tableName
          };
          
          tableForm.querySelectorAll('.column-container').forEach(column => {
            const columnName = column.querySelector('.columnName').value;
            
            if (!columnName) return;
            
            const type = column.querySelector('.columnType').value;
            const properties = [];
            
            // Verifica as propriedades
            if (column.querySelector('.prop-primary').checked) properties.push("primary");
            if (column.querySelector('.prop-increments').checked) properties.push("increments");
            if (column.querySelector('.prop-notNullable').checked) properties.push("notNullable");
            if (column.querySelector('.prop-show').checked) properties.push("show");
            
            // Tratamento de chave estrangeira
            if (column.querySelector('.prop-foreign').checked) {
              const foreignRef = column.querySelector('.foreignRef').value;
              if (foreignRef) {
                properties.push(`foreign.${foreignRef}`);
              } else {
                properties.push("foreign");
              }
            }
            
            // Adiciona o tipo como a primeira propriedade
            tableObj[columnName] = [type, ...properties];
          });
          
          output.push(tableObj);
        });
        
        // Atualiza o contador de tabelas
        tableCountEl.textContent = output.length;
        
        // Atualiza a exibição do JSON com syntax highlighting
        jsonOutput.innerHTML = syntaxHighlight({
          templates: output
        }).replace(/"templates": /, "const templates = ");
      }

      // Mostra estado vazio se não houver tabelas
      function updateEmptyState() {
        if (tablesContainer.children.length === 0) {
          const emptyState = document.createElement('div');
          emptyState.className = 'empty-state';
          emptyState.innerHTML = `
            <div class="empty-state-icon"><i class="fas fa-database"></i></div>
            <h3 class="empty-state-title">No Tables Defined</h3>
            <p class="empty-state-text">Create your first table to get started with your database schema</p>
            <button class="btn btn-primary empty-add-btn">
              <i class="fas fa-plus"></i> Add Table
            </button>
          `;
          tablesContainer.appendChild(emptyState);
          
          // Add event listener to the empty state button
          emptyState.querySelector('.empty-add-btn').addEventListener('click', addTable);
        } else {
          const emptyState = tablesContainer.querySelector('.empty-state');
          if (emptyState) {
            emptyState.remove();
          }
        }
      }

      // Initialize with empty table
      addTable();
    });
  </script>

  <script src="projetoGenerator.js"></script>
</body>
</html>